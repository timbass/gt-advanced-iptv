<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GT Advanced IPTV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            cursor: none;
        }

        .tv-container {
            width: 100%;
            height: 100vh;
            padding: 30px;
        }

        .tv-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 40px;
            border-bottom: 2px solid rgba(100, 255, 218, 0.3);
        }

        .tv-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #64ffda, #4facfe);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #0a192f;
        }

        .logo-text {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(45deg, #64ffda, #4facfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tv-status {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4caf50;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        .current-time {
            font-size: 28px;
            font-weight: bold;
        }

        .tv-dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            grid-template-rows: 300px 150px;
            gap: 30px;
            height: calc(100vh - 200px);
        }

        .tv-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .tv-card:hover, .tv-card.focused {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: #64ffda;
            background: rgba(100, 255, 218, 0.2);
        }

        .live-tv-card {
            grid-row: span 2;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-icon {
            font-size: 80px;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .icon-tv::before {
            content: "TV";
            font-size: 40px;
            display: block;
            width: 80px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border: 4px solid white;
            border-radius: 8px;
            line-height: 52px;
            text-align: center;
        }

        .icon-movies::before {
            content: "‚ñ∂";
            font-size: 60px;
        }

        .icon-series::before {
            content: "‚â°";
            font-size: 60px;
        }

        .icon-epg::before {
            content: "üìÖ";
            font-size: 40px;
        }

        .icon-recordings::before {
            content: "‚óè";
            font-size: 40px;
            color: #ff4444;
        }

        .icon-settings::before {
            content: "‚öô";
            font-size: 40px;
        }

        .icon-folder::before {
            content: "üìÅ";
            font-size: 48px;
        }

        .icon-refresh::before {
            content: "‚Üª";
            font-size: 48px;
        }

        .icon-info::before {
            content: "i";
            font-size: 48px;
            display: inline-block;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            line-height: 60px;
            text-align: center;
        }

        .card-title {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .card-subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-top: 10px;
            text-align: center;
        }

        .channel-count {
            font-size: 14px;
            margin-top: 5px;
            color: #64ffda;
            font-weight: bold;
        }

        .movies-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .movies-card .card-icon {
            font-size: 60px;
        }

        .movies-card .card-title {
            font-size: 24px;
        }

        .series-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .series-card .card-icon {
            font-size: 60px;
        }

        .series-card .card-title {
            font-size: 24px;
        }

        .bottom-cards {
            display: flex;
            gap: 20px;
            grid-column: 2 / 4;
        }

        .small-card {
            flex: 1;
            height: 150px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .small-card:hover, .small-card.focused {
            transform: translateY(-5px);
            border-color: #64ffda;
        }

        .epg-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .recordings-card {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .settings-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .small-card .card-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .small-card .card-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }

        .tv-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            padding: 30px;
        }

        .modal-content {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 30px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 32px;
            font-weight: bold;
        }

        .close-btn {
            font-size: 40px;
            cursor: pointer;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .close-btn:hover, .close-btn.focused {
            background: #f44336;
            border-color: white;
        }

        .settings-content {
            padding: 40px;
            flex: 1;
            overflow-y: auto;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        .setting-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .setting-card:hover, .setting-card.focused {
            background: rgba(100, 255, 218, 0.2);
            border-color: #64ffda;
            transform: translateY(-5px);
        }

        .setting-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .setting-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .setting-description {
            font-size: 14px;
            opacity: 0.8;
        }

        .setup-form {
            padding: 40px;
            flex: 1;
        }

        .form-group {
            margin-bottom: 30px;
        }

        .form-label {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(100, 255, 218, 0.3);
            border-radius: 10px;
            color: white;
            transition: all 0.3s;
        }

        .form-input:focus, .form-input.focused {
            outline: none;
            border-color: #64ffda;
            background: rgba(100, 255, 218, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .tv-button {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .tv-button.primary {
            background: linear-gradient(45deg, #64ffda, #4facfe);
            color: #0a192f;
        }

        .tv-button.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .tv-button:hover, .tv-button.focused {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-color: white;
        }

        .live-tv-interface {
            display: flex;
            height: 100%;
        }

        .channel-sidebar {
            width: 350px;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .m3u-file-input {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(100, 255, 218, 0.5);
            border-radius: 10px;
            text-align: center;
        }

        .file-input {
            display: none;
        }

        .file-label {
            cursor: pointer;
            padding: 10px 20px;
            background: rgba(100, 255, 218, 0.2);
            border-radius: 8px;
            display: inline-block;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: rgba(100, 255, 218, 0.4);
        }

        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .channel-item:hover, .channel-item.focused {
            background: rgba(100, 255, 218, 0.2);
            border-color: #64ffda;
        }

        .channel-item.playing {
            background: rgba(255, 107, 53, 0.3);
            border-color: #ff6b35;
        }

        .channel-logo {
            width: 50px;
            height: 35px;
            background: #64ffda;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0a192f;
            margin-right: 15px;
            font-size: 10px;
        }

        .channel-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .channel-info p {
            font-size: 12px;
            opacity: 0.7;
        }

        .video-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .video-player {
            flex: 1;
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .video-element {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-placeholder {
            text-align: center;
            color: #666;
        }

        .video-placeholder .icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .video-placeholder .title {
            font-size: 28px;
            margin-bottom: 10px;
            color: white;
        }

        .video-placeholder .subtitle {
            font-size: 16px;
        }

        .player-controls {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .control-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .control-btn:hover, .control-btn.focused {
            background: #64ffda;
            color: #0a192f;
            border-color: white;
        }

        .focused {
            outline: none !important;
        }

        .status-message {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            display: none;
            z-index: 1002;
        }

        .status-message.success {
            border-left: 4px solid #4caf50;
        }

        .status-message.error {
            border-left: 4px solid #f44336;
        }

        .video-placeholder-icon::before {
            content: "TV";
            font-size: 50px;
            display: block;
            width: 100px;
            height: 70px;
            background: rgba(255,255,255,0.1);
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            line-height: 62px;
            text-align: center;
            margin: 0 auto 20px;
        }

        .channel-empty-icon::before {
            content: "TV";
            font-size: 30px;
            display: block;
            width: 60px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            line-height: 36px;
            text-align: center;
            margin: 0 auto 20px;
        }

        .connection-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 10px;
            font-size: 14px;
        }

        .connection-info.error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .connection-info.success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 1001;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            border-top: 3px solid #64ffda;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="tv-container">
        <div class="tv-header">
            <div class="tv-logo">
                <div class="logo-icon">GT</div>
                <div class="logo-text">GT Advanced IPTV</div>
            </div>
            <div class="tv-status">
                <div class="status-item">
                    <div class="status-indicator disconnected" id="connectionStatus"></div>
                    <span id="connectionText">Ready</span>
                </div>
                <div class="current-time" id="currentTime">17:07</div>
            </div>
        </div>

        <div class="tv-dashboard">
            <div class="tv-card live-tv-card" tabindex="0" data-action="live-tv">
                <div class="card-icon icon-tv"></div>
                <div class="card-title">LIVE TV</div>
                <div class="card-subtitle">Watch live channels</div>
                <div class="channel-count" id="channelCount">Load M3U playlist to start</div>
            </div>

            <div class="tv-card movies-card" tabindex="0" data-action="movies">
                <div class="card-icon icon-movies"></div>
                <div class="card-title">MOVIES</div>
                <div class="card-subtitle">Browse movies</div>
                <div class="channel-count">Coming soon</div>
            </div>

            <div class="tv-card series-card" tabindex="0" data-action="series">
                <div class="card-icon icon-series"></div>
                <div class="card-title">SERIES</div>
                <div class="card-subtitle">TV shows</div>
                <div class="channel-count">Coming soon</div>
            </div>

            <div class="bottom-cards">
                <div class="small-card epg-card" tabindex="0" data-action="epg">
                    <div class="card-icon icon-epg"></div>
                    <div class="card-title">EPG GUIDE</div>
                </div>
                
                <div class="small-card recordings-card" tabindex="0" data-action="recordings">
                    <div class="card-icon icon-recordings"></div>
                    <div class="card-title">RECORDINGS</div>
                </div>
                
                <div class="small-card settings-card" tabindex="0" data-action="settings">
                    <div class="card-icon icon-settings"></div>
                    <div class="card-title">SETTINGS</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="tv-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Settings</div>
                <div class="close-btn" tabindex="0" onclick="closeModal('settingsModal')">&times;</div>
            </div>
            <div class="settings-content">
                <div class="settings-grid">
                    <div class="setting-card" tabindex="0" data-setting="m3u">
                        <div class="setting-icon icon-folder"></div>
                        <div class="setting-title">Load M3U Playlist</div>
                        <div class="setting-description">Load channels from M3U file or URL</div>
                    </div>
                    
                    <div class="setting-card" tabindex="0" data-setting="reload">
                        <div class="setting-icon icon-refresh"></div>
                        <div class="setting-title">Clear Playlist</div>
                        <div class="setting-description">Clear loaded channels</div>
                    </div>
                    
                    <div class="setting-card" tabindex="0" data-setting="about">
                        <div class="setting-icon icon-info"></div>
                        <div class="setting-title">About</div>
                        <div class="setting-description">App information</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- M3U Setup Modal -->
    <div class="tv-modal" id="m3uModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Load M3U Playlist</div>
                <div class="close-btn" tabindex="0" onclick="closeModal('m3uModal')">&times;</div>
            </div>
            <div class="setup-form">
                <div class="form-group">
                    <label class="form-label">M3U URL</label>
                    <input type="text" class="form-input" id="m3uUrl" placeholder="http://example.com/playlist.m3u" tabindex="0">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Or Upload M3U File</label>
                    <div class="m3u-file-input">
                        <input type="file" id="m3uFile" class="file-input" accept=".m3u,.m3u8" tabindex="0">
                        <label for="m3uFile" class="file-label">Choose M3U File</label>
                        <div id="fileName" style="margin-top: 10px; font-size: 12px; opacity: 0.8;"></div>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button class="tv-button primary" tabindex="0" onclick="loadM3UPlaylist()">Load Playlist</button>
                    <button class="tv-button secondary" tabindex="0" onclick="loadSamplePlaylist()">Load Sample</button>
                </div>
                
                <div class="connection-info" id="m3uConnectionInfo" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Live TV Modal -->
    <div class="tv-modal" id="liveTVModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Live TV</div>
                <div class="close-btn" tabindex="0" onclick="closeModal('liveTVModal')">&times;</div>
            </div>
            <div class="live-tv-interface">
                <div class="channel-sidebar">
                    <h3 style="margin-bottom: 20px;">Channels (<span id="channelListCount">0</span>)</h3>
                    <div class="channel-list" id="channelList">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 20px;">üì°</div>
                            <div>No channels loaded</div>
                            <div style="font-size: 12px; margin-top: 10px;">Load an M3U playlist in Settings</div>
                        </div>
                    </div>
                </div>
                
                <div class="video-area">
                    <div class="video-player" id="videoPlayer">
                        <div class="video-placeholder">
                            <div class="video-placeholder-icon"></div>
                            <div class="title">Select a channel</div>
                            <div class="subtitle">Choose from the channel list to start watching</div>
                        </div>
                    </div>
                    
                    <div class="player-controls">
                        <button class="control-btn" tabindex="0" onclick="playPause()">‚ñ∂ Play</button>
                        <button class="control-btn" tabindex="0" onclick="previousChannel()">‚óÄ‚óÄ Previous</button>
                        <button class="control-btn" tabindex="0" onclick="nextChannel()">‚ñ∂‚ñ∂ Next</button>
                        <button class="control-btn" tabindex="0" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="status-message" id="statusMessage"></div>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <script>
        // App State
        let currentFocus = 0;
        let focusableElements = [];
        let currentModal = null;
        let channels = [];
        let currentChannel = null;
        let currentVideo = null;
        let isPlaying = false;
        let hlsInstance = null;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadSavedChannels();
            updateFocusableElements();
            updateTime();
            setInterval(updateTime, 1000);
            
            if (focusableElements.length > 0) {
                focusableElements[0].focus();
                focusableElements[0].classList.add('focused');
            }
            
            // File input handler
            document.getElementById('m3uFile').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'No file selected';
                document.getElementById('fileName').textContent = fileName;
            });
        }

        function loadSavedChannels() {
            const savedChannels = JSON.parse(localStorage.getItem('iptv_channels') || '[]');
            if (savedChannels.length > 0) {
                channels = savedChannels;
                updateConnectionStatus(`${channels.length} channels loaded`, true);
                updateDashboardCounts();
            }
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        function updateConnectionStatus(text, connected) {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            statusIndicator.className = `status-indicator ${connected ? '' : 'disconnected'}`;
            statusText.textContent = text;
        }

        // Navigation System
        function updateFocusableElements() {
            const currentContainer = currentModal || document;
            focusableElements = Array.from(currentContainer.querySelectorAll('[tabindex="0"]:not([disabled])'));
            currentFocus = 0;
        }

        document.addEventListener('keydown', function(e) {
            e.preventDefault();
            
            switch(e.keyCode) {
                case 37: navigateLeft(); break;
                case 39: navigateRight(); break;
                case 38: navigateUp(); break;
                case 40: navigateDown(); break;
                case 13: selectCurrent(); break;
                case 8: case 27: case 461: goBack(); break;
            }
        });

        function navigateLeft() {
            changeFocus(currentFocus - 1);
        }

        function navigateRight() {
            changeFocus(currentFocus + 1);
        }

        function navigateUp() {
            changeFocus(currentFocus - 1);
        }

        function navigateDown() {
            changeFocus(currentFocus + 1);
        }

        function changeFocus(newIndex) {
            if (newIndex < 0 || newIndex >= focusableElements.length) return;
            
            if (focusableElements[currentFocus]) {
                focusableElements[currentFocus].classList.remove('focused');
                focusableElements[currentFocus].blur();
            }
            
            currentFocus = newIndex;
            if (focusableElements[currentFocus]) {
                focusableElements[currentFocus].focus();
                focusableElements[currentFocus].classList.add('focused');
                focusableElements[currentFocus].scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            }
        }

        function selectCurrent() {
            const element = focusableElements[currentFocus];
            if (!element) return;
            
            if (element.dataset.action) {
                handleAction(element.dataset.action);
            } else if (element.dataset.setting) {
                handleSetting(element.dataset.setting);
            } else if (element.dataset.channel) {
                selectChannel(element.dataset.channel);
            } else if (element.onclick) {
                element.onclick();
            } else {
                element.click();
            }
        }

        function goBack() {
            if (currentModal) {
                closeModal(currentModal.id);
            }
        }

        // Action Handlers
        function handleAction(action) {
            switch(action) {
                case 'live-tv':
                    if (channels.length === 0) {
                        showStatus('No channels loaded. Load M3U playlist first.', 'error', 3000);
                        return;
                    }
                    openModal('liveTVModal');
                    break;
                case 'movies':
                    showStatus('Movies feature coming soon', 'info', 2000);
                    break;
                case 'series':
                    showStatus('Series feature coming soon', 'info', 2000);
                    break;
                case 'settings':
                    openModal('settingsModal');
                    break;
                default:
                    showStatus('Feature coming soon', 'info', 2000);
            }
        }

        function handleSetting(setting) {
            switch(setting) {
                case 'm3u':
                    closeModal('settingsModal');
                    setTimeout(() => openModal('m3uModal'), 300);
                    break;
                case 'reload':
                    clearPlaylist();
                    break;
                case 'about':
                    showStatus('GT Advanced IPTV v2.0 - Fixed Version', 'info', 3000);
                    break;
            }
        }

        // Modal System
        function openModal(modalId) {
            currentModal = document.getElementById(modalId);
            currentModal.style.display = 'block';
            updateFocusableElements();
            
            if (focusableElements.length > 0) {
                setTimeout(() => {
                    currentFocus = 0;
                    focusableElements[0].focus();
                    focusableElements[0].classList.add('focused');
                }, 100);
            }

            if (modalId === 'liveTVModal') {
                populateChannels();
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            currentModal = null;
            
            updateFocusableElements();
            if (focusableElements.length > 0) {
                currentFocus = 0;
                focusableElements[0].focus();
                focusableElements[0].classList.add('focused');
            }
        }

        // M3U Functions
        function loadM3UPlaylist() {
            const m3uUrl = document.getElementById('m3uUrl').value.trim();
            const m3uFile = document.getElementById('m3uFile').files[0];
            
            if (m3uUrl) {
                loadM3UFromURL(m3uUrl);
            } else if (m3uFile) {
                loadM3UFromFile(m3uFile);
            } else {
                showM3UConnectionInfo('Please provide either a URL or file', 'error');
            }
        }

        function loadM3UFromURL(url) {
            showLoading();
            showM3UConnectionInfo('Loading playlist from URL...', 'info');
            
            // Use a proxy service to bypass CORS
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            
            fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.text();
                })
                .then(m3uContent => {
                    parseM3UContent(m3uContent);
                    hideLoading();
                    showM3UConnectionInfo('Playlist loaded successfully!', 'success');
                })
                .catch(error => {
                    hideLoading();
                    showM3UConnectionInfo(`Failed to load playlist: ${error.message}`, 'error');
                    console.error('M3U load error:', error);
                });
        }

        function loadM3UFromFile(file) {
            showLoading();
            showM3UConnectionInfo('Reading file...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    parseM3UContent(e.target.result);
                    hideLoading();
                    showM3UConnectionInfo('File loaded successfully!', 'success');
                } catch (error) {
                    hideLoading();
                    showM3UConnectionInfo(`Failed to parse file: ${error.message}`, 'error');
                }
            };
            
            reader.onerror = function() {
                hideLoading();
                showM3UConnectionInfo('Failed to read file', 'error');
            };
            
            reader.readAsText(file);
        }

        function loadSamplePlaylist() {
            showLoading();
            showM3UConnectionInfo('Loading sample playlist...', 'info');
            
            const sampleM3U = `#EXTM3U
#EXTINF:-1 tvg-id="sample1" tvg-name="Sample News" tvg-logo="" group-title="News",Sample News
https://cnn-cnninternational-1-gb.samsung.wurl.com/manifest/playlist.m3u8
#EXTINF:-1 tvg-id="sample2" tvg-name="Sample Sports" tvg-logo="" group-title="Sports",Sample Sports
https://reuters-reutersnow-1-gb.samsung.wurl.com/manifest/playlist.m3u8
#EXTINF:-1 tvg-id="sample3" tvg-name="Sample Music" tvg-logo="" group-title="Music",Sample Music
https://d2e1asnsl7br7b.cloudfront.net/7782e205e72f43aeb4a48ec97f66ebbe/index.m3u8
#EXTINF:-1 tvg-id="sample4" tvg-name="Big Buck Bunny" tvg-logo="" group-title="Test",Big Buck Bunny
https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4`;
            
            setTimeout(() => {
                try {
                    parseM3UContent(sampleM3U);
                    hideLoading();
                    showM3UConnectionInfo('Sample playlist loaded!', 'success');
                } catch (error) {
                    hideLoading();
                    showM3UConnectionInfo(`Error: ${error.message}`, 'error');
                }
            }, 1000);
        }

        function parseM3UContent(content) {
            const lines = content.split('\n');
            const parsedChannels = [];
            let currentChannel = {};
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    // Parse channel info
                    const nameMatch = line.match(/,(.+)$/);
                    const groupMatch = line.match(/group-title="([^"]*)"/);
                    const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                    const idMatch = line.match(/tvg-id="([^"]*)"/);
                    
                    currentChannel = {
                        id: idMatch ? idMatch[1] : Math.random().toString(36),
                        name: nameMatch ? nameMatch[1] : 'Unknown Channel',
                        group: groupMatch ? groupMatch[1] : 'Uncategorized',
                        logo: logoMatch ? logoMatch[1] : '',
                        url: ''
                    };
                } else if (line && !line.startsWith('#') && currentChannel.name) {
                    // This is the URL line
                    currentChannel.url = line;
                    parsedChannels.push(currentChannel);
                    currentChannel = {};
                }
            }
            
            if (parsedChannels.length === 0) {
                throw new Error('No valid channels found in playlist');
            }
            
            channels = parsedChannels;
            localStorage.setItem('iptv_channels', JSON.stringify(channels));
            updateConnectionStatus(`${channels.length} channels loaded`, true);
            updateDashboardCounts();
            
            showStatus(`Loaded ${channels.length} channels successfully!`, 'success', 3000);
        }

        function clearPlaylist() {
            channels = [];
            localStorage.removeItem('iptv_channels');
            updateConnectionStatus('Ready', false);
            updateDashboardCounts();
            showStatus('Playlist cleared', 'info', 2000);
        }

        function populateChannels() {
            const channelList = document.getElementById('channelList');
            
            if (channels.length === 0) {
                channelList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div class="channel-empty-icon"></div>
                        <div>No channels loaded</div>
                        <div style="font-size: 12px; margin-top: 10px;">Load an M3U playlist in Settings</div>
                    </div>
                `;
                return;
            }

            channelList.innerHTML = channels.map(channel => `
                <div class="channel-item" tabindex="0" data-channel="${channel.id}">
                    <div class="channel-logo">${channel.name.substring(0, 3).toUpperCase()}</div>
                    <div class="channel-info">
                        <h3>${channel.name}</h3>
                        <p>${channel.group || 'Live'} ‚Ä¢ HD</p>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('channelListCount').textContent = channels.length;
            updateFocusableElements();
        }

        function selectChannel(channelId) {
            const channel = channels.find(ch => ch.id === channelId);
            if (!channel) return;
            
            // Update UI
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('playing');
            });
            
            const selectedItem = document.querySelector(`[data-channel="${channelId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('playing');
            }
            
            // Stop current video
            if (hlsInstance) {
                hlsInstance.destroy();
                hlsInstance = null;
            }
            
            // Update video player
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.innerHTML = `
                <video class="video-element" controls autoplay muted>
                    <source src="${channel.url}" type="application/x-mpegURL">
                    <source src="${channel.url}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            `;
            
            currentChannel = channel;
            currentVideo = videoPlayer.querySelector('video');
            isPlaying = true;
            
            // Use HLS.js for m3u8 streams
            if (channel.url.includes('.m3u8') && Hls.isSupported()) {
                hlsInstance = new Hls({
                    debug: false,
                    enableWorker: false,
                    lowLatencyMode: true
                });
                
                hlsInstance.loadSource(channel.url);
                hlsInstance.attachMedia(currentVideo);
                
                hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => {
                    currentVideo.play().catch(e => console.log('Autoplay prevented'));
                });
                
                hlsInstance.on(Hls.Events.ERROR, (event, data) => {
                    console.error('HLS Error:', data);
                    if (data.fatal) {
                        showStatus('Stream error - trying fallback', 'error', 3000);
                    }
                });
            }
            
            showStatus(`Now playing: ${channel.name}`, 'success', 3000);
            
            // Handle video events
            if (currentVideo) {
                currentVideo.addEventListener('error', () => {
                    showStatus('Stream error - check connection', 'error', 3000);
                });
                
                currentVideo.addEventListener('loadstart', () => {
                    showStatus('Loading stream...', 'info', 2000);
                });
            }
        }

        function updateDashboardCounts() {
            document.getElementById('channelCount').textContent = 
                channels.length > 0 ? `${channels.length} channels` : 'Load M3U playlist to start';
        }

        // Player Controls
        function playPause() {
            if (!currentVideo) {
                showStatus('Select a channel first', 'info', 2000);
                return;
            }
            
            if (isPlaying) {
                currentVideo.pause();
                isPlaying = false;
                showStatus('Paused', 'info', 1000);
            } else {
                currentVideo.play();
                isPlaying = true;
                showStatus('Playing', 'info', 1000);
            }
        }

        function previousChannel() {
            if (!currentChannel || channels.length === 0) return;
            
            const currentIndex = channels.findIndex(ch => ch.id === currentChannel.id);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : channels.length - 1;
            selectChannel(channels[prevIndex].id);
        }

        function nextChannel() {
            if (!currentChannel || channels.length === 0) return;
            
            const currentIndex = channels.findIndex(ch => ch.id === currentChannel.id);
            const nextIndex = currentIndex < channels.length - 1 ? currentIndex + 1 : 0;
            selectChannel(channels[nextIndex].id);
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
                showStatus('Exited fullscreen', 'info', 1500);
            } else {
                document.documentElement.requestFullscreen();
                showStatus('Entered fullscreen', 'info', 1500);
            }
        }

        // Utility Functions
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showStatus(message, type, duration) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, duration);
        }

        function showM3UConnectionInfo(message, type) {
            const infoEl = document.getElementById('m3uConnectionInfo');
            infoEl.textContent = message;
            infoEl.className = `connection-info ${type}`;
            infoEl.style.display = 'block';
        }

        // Click fallback
        document.addEventListener('click', function(e) {
            const element = e.target.closest('[tabindex="0"]');
            if (element) {
                const index = focusableElements.indexOf(element);
                if (index !== -1) {
                    currentFocus = index;
                    selectCurrent();
                }
            }
        });

        console.log('GT Advanced IPTV - Fixed Version Loaded');
    </script>
</body>
</html>
